# ModelScope API Gateway - 开发环境 Docker Compose
#
# 启动命令:
#   docker-compose -f deploy/docker-compose.dev.yml up
#
# 特点:
#   - 热重载（代码修改自动重启）
#   - 挂载源代码

version: "3.8"

services:
  modelscope-gateway:
    build:
      context: ..
      dockerfile: deploy/Dockerfile
    container_name: modelscope-gateway-dev
    restart: "no"
    ports:
      - "${SERVER_PORT:-8000}:8000"
    environment:
      - MODELSCOPE_API_KEY=${MODELSCOPE_API_KEY}
      - SERVER_HOST=0.0.0.0
      - SERVER_PORT=8000
    env_file:
      - ../.env
    volumes:
      # 挂载核心模块实现热重载
      - ../core:/app/core:ro
      # 挂载服务入口和配置
      - ../server.py:/app/server.py:ro
      - ../models_config.json:/app/models_config.json:ro
      # 数据目录
      - ../usage:/app/usage
      - ../limits:/app/limits
    command: ["uvicorn", "server:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
    networks:
      - modelscope-net

networks:
  modelscope-net:
    driver: bridge
